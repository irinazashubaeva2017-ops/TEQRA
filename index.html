<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TEQRA ‚Äî –ú–∞–≥–∞–∑–∏–Ω –Ω–æ—É—Ç–±—É–∫—ñ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background:#0b0f1a; color:#e2e8f0; font-family: 'Inter', sans-serif; }
        .glow { box-shadow: 0 0 20px rgba(0, 240, 255, 0.15); transition: 0.3s; }
        .glow:hover { box-shadow: 0 0 30px rgba(0, 240, 255, 0.3); transform: translateY(-2px); }
        .cyber-border { border: 1px solid rgba(0, 240, 255, 0.2); background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); }
        .admin-input { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; width: 100%; margin-bottom: 10px; }
        .admin-input:focus { border-color: #06b6d4; outline: none; }
        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<header class="p-4 flex justify-between items-center border-b border-cyan-500/20 sticky top-0 bg-[#0b0f1a]/80 backdrop-blur-md z-50">
    <h1 class="text-2xl font-black text-cyan-400 tracking-[0.2em]">TEQRA</h1>
    <div class="flex gap-3">
        <button onclick="toggleCart()" class="px-4 py-2 bg-cyan-600/20 text-cyan-400 border border-cyan-500/50 rounded-lg hover:bg-cyan-600 hover:text-white transition">–ö–æ—à–∏–∫</button>
        <button onclick="adminLogin()" class="px-3 py-2 bg-purple-600/20 text-purple-400 border border-purple-500/50 rounded-lg hover:bg-purple-600 hover:text-white transition">‚ö°</button>
    </div>
</header>

<main class="flex-1 p-6">
    <div id="catalog" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    
    <div id="emptyState" class="hidden flex flex-col items-center justify-center mt-32 text-center">
        <div class="text-8xl animate-bounce">üöÄ</div>
        <p class="mt-6 text-2xl font-light text-cyan-300">
            –¢–æ–≤–∞—Ä–∏ –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ... <br><span class="text-sm opacity-50 uppercase tracking-widest">–ù–æ—É—Ç–±—É–∫–∏ –ø–æ–ª–µ—Ç—ñ–ª–∏ –≤ –∫–æ—Å–º–æ—Å</span>
        </p>
    </div>
</main>

<div id="cartPanel" class="fixed right-0 top-0 h-full w-full sm:w-[400px] bg-[#0f172a] border-l border-cyan-500/20 p-6 hidden z-[60] shadow-2xl">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-cyan-400 uppercase">–ö–æ—à–∏–∫</h2>
        <button onclick="toggleCart()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
    </div>
    <div id="cartItems" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2"></div>
    
    <div class="mt-8 border-t border-slate-700 pt-6">
        <form id="orderForm" onsubmit="sendOrder(event)" class="space-y-3">
            <input required id="orderName" placeholder="–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ" class="admin-input"/>
            <input required id="orderPhone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É" class="admin-input"/>
            <button type="submit" class="w-full bg-cyan-600 py-3 rounded-xl font-bold uppercase tracking-wider hover:bg-cyan-500 transition">–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        </form>
    </div>
</div>

<div id="adminPanel" class="fixed inset-0 bg-black/90 hidden flex justify-center items-center z-[70] p-4">
    <div class="bg-slate-900 border border-cyan-500/30 p-8 w-full max-w-md rounded-2xl shadow-2xl">
        <h2 class="text-cyan-400 text-2xl font-bold mb-6 uppercase tracking-tight">–î–æ–¥–∞—Ç–∏ –Ω–æ—É—Ç–±—É–∫</h2>
        
        <input id="model" placeholder="–ú–æ–¥–µ–ª—å (–Ω–∞–ø—Ä. Dell Latitude)" class="admin-input"/>
        <input id="price" type="number" placeholder="–¶—ñ–Ω–∞ (–≥—Ä–Ω)" class="admin-input"/>
        <textarea id="specs" placeholder="–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (CPU, RAM, SSD...)" class="admin-input h-24"></textarea>
        
        <label class="block mb-4">
            <span class="text-sm text-gray-400 mb-2 block">–§–æ—Ç–æ –Ω–æ—É—Ç–±—É–∫–∞:</span>
            <input type="file" id="imageUpload" class="text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-600/20 file:text-cyan-400 hover:file:bg-cyan-600/30 cursor-pointer"/>
        </label>

        <button id="addBtn" onclick="addProduct()" class="w-full bg-green-600 py-3 rounded-xl font-bold mb-3 hover:bg-green-500 transition disabled:opacity-50">–î–û–î–ê–¢–ò –í –ö–ê–¢–ê–õ–û–ì</button>
        <button onclick="closeAdmin()" class="w-full bg-slate-800 py-3 rounded-xl font-bold text-gray-400 hover:bg-slate-700 transition">–°–ö–ê–°–£–í–ê–¢–ò</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCuYjKFAsKbdu_PLI4OkxiW6Wz-Yhq_q44",
        databaseURL: "https://catalog-b9cc2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "catalog-b9cc2",
        storageBucket: "catalog-b9cc2.firebasestorage.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let cart = [];

    // –í–∏–Ω–æ—Å–∏–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ window, —â–æ–± –∫–Ω–æ–ø–∫–∏ –≤ HTML —ó—Ö –±–∞—á–∏–ª–∏
    window.toggleCart = () => document.getElementById("cartPanel").classList.toggle("hidden");
    window.closeAdmin = () => document.getElementById("adminPanel").classList.add("hidden");

    window.adminLogin = () => {
        const pass = prompt("–í–≤–µ–¥—ñ—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–æ–¥:");
        if (pass === "teqra2026") {
            document.getElementById("adminPanel").classList.remove("hidden");
        } else {
            alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥!");
        }
    };

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
    onValue(ref(db, "products"), (snapshot) => {
        const catalog = document.getElementById("catalog");
        const emptyState = document.getElementById("emptyState");
        const data = snapshot.val();
        
        catalog.innerHTML = "";
        
        if (!data) {
            emptyState.classList.remove("hidden");
            return;
        }
        
        emptyState.classList.add("hidden");
        Object.entries(data).forEach(([id, item]) => {
            catalog.innerHTML += `
                <div class="cyber-border p-4 rounded-2xl glow flex flex-col">
                    <div class="h-48 overflow-hidden rounded-xl mb-4 bg-slate-800">
                        <img src="${item.image || 'https://via.placeholder.com/400x300?text=TEQRA'}" class="w-full h-full object-cover"/>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-1">${item.model}</h3>
                    <p class="text-xs text-cyan-400/70 uppercase tracking-tighter mb-3 font-mono">${item.specs}</p>
                    <div class="mt-auto flex justify-between items-center">
                        <span class="text-lg font-black text-white">${item.price} ‚Ç¥</span>
                        <button onclick='addToCart(${JSON.stringify({id, ...item})})' class="bg-cyan-600 hover:bg-cyan-500 p-2 px-4 rounded-lg text-sm transition font-bold">–í –ö–û–®–ò–ö</button>
                    </div>
                    ${passIsAdmin ? `<button onclick="deleteProduct('${id}')" class="text-[10px] text-red-900 mt-2 text-left hover:text-red-500">–í–∏–¥–∞–ª–∏—Ç–∏ (Admin)</button>` : ''}
                </div>`;
        });
    });

    let passIsAdmin = false; // –î–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

    window.addToCart = (item) => {
        cart.push(item);
        renderCart();
        alert(`–î–æ–¥–∞–Ω–æ: ${item.model}`);
    };

    function renderCart() {
        const container = document.getElementById("cartItems");
        container.innerHTML = cart.length === 0 ? "<p class='text-gray-500'>–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>" : "";
        cart.forEach((item, index) => {
            container.innerHTML += `
                <div class="flex justify-between items-center bg-slate-800/50 p-3 rounded-xl border border-slate-700">
                    <div>
                        <p class="font-bold text-sm">${item.model}</p>
                        <p class="text-cyan-400 text-xs">${item.price} ‚Ç¥</p>
                    </div>
                    <button onclick="removeFromCart(${index})" class="text-red-400 text-xs">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>`;
        });
    }

    window.removeFromCart = (index) => {
        cart.splice(index, 1);
        renderCart();
    };

    // –î–û–î–ê–í–ê–ù–ù–Ø –¢–û–í–ê–†–£
    window.addProduct = async () => {
        const model = document.getElementById("model").value;
        const price = document.getElementById("price").value;
        const specs = document.getElementById("specs").value;
        const file = document.getElementById("imageUpload").files[0];
        const btn = document.getElementById("addBtn");

        if (!model || !price) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –º–æ–¥–µ–ª—å —Ç–∞ —Ü—ñ–Ω—É!");

        btn.disabled = true;
        btn.innerText = "–ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø...";

        let imageUrl = "";
        if (file) {
            const formData = new FormData();
            formData.append("image", file);
            try {
                const res = await fetch("https://api.imgbb.com/1/upload?key=70bb1de10d70f62410bc55ddd2a4fd0e", {
                    method: "POST",
                    body: formData
                });
                const imgData = await res.json();
                imageUrl = imgData.data.url;
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ ImgBB:", e);
            }
        }

        push(ref(db, "products"), { model, price, specs, image: imageUrl })
            .then(() => {
                btn.disabled = false;
                btn.innerText = "–î–û–î–ê–¢–ò –í –ö–ê–¢–ê–õ–û–ì";
                closeAdmin();
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—ñ–≤
                document.getElementById("model").value = "";
                document.getElementById("price").value = "";
                document.getElementById("specs").value = "";
            });
    };

    window.sendOrder = (e) => {
        e.preventDefault();
        const name = document.getElementById("orderName").value;
        const phone = document.getElementById("orderPhone").value;
        if(cart.length === 0) return alert("–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π!");
        
        const message = `–ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!\n–ö–ª—ñ—î–Ω—Ç: ${name}\n–¢–µ–ª: ${phone}\n–¢–æ–≤–∞—Ä–∏: ${cart.map(i => i.model).join(", ")}`;
        alert("–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ! (–¢—É—Ç –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫—É –≤ Telegram)\n\n" + message);
        cart = [];
        renderCart();
        toggleCart();
    };

    window.deleteProduct = (id) => {
        if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?")) {
            remove(ref(db, `products/${id}`));
        }
    };
</script>

</body>
</html>
